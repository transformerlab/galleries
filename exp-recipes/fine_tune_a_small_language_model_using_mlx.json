{
  "id": "fine_tune_small_mlx",
  "title": "Fine Tune a Small Language Model using MLX",
  "description": "Train a Llama 3.2 1B model to understand and answer questions about Touch Rugby rules using the MLX framework. Perfect for rule-based question answering.",
  "notes": "# Fine-Tune LLaMA 3.2 for Touch Rugby Rules (MLX)\n\n## Overview\nThis recipe fine-tunes the **LLaMA 3.2-1B-Instruct-4bit** model to become an expert in Touch Rugby rules and regulations, using the MLX framework optimized for Apple Silicon. It includes training, evaluation, and data generation components for a comprehensive learning pipeline.\n\nTo get started, simply go to the **Workflows** page and click **Run** \u2014 the entire process is automated for you.\n\n## Workflow Breakdown\nThe workflow consists of the following automated steps:\n\n1. **Fine-Tuning**  \n   The model is fine-tuned using the Touch Rugby rules dataset with LoRA adaptation, learning Q&A patterns about game rules, procedures, and regulations.\n\n2. **Evaluation**  \n   The fine-tuned model is evaluated on the MMLU benchmark to assess its general knowledge retention after specialized training.\n\n3. **Example Generation**  \n   The trained model generates additional Touch Rugby Q&A examples to demonstrate its learned capabilities and create more training data.\n\n## How to Use the Fine-Tuned Model\nOnce the training is complete, you can interact with the updated model directly:\n\n1. Go to the **Foundation** tab  \n2. Look for the model titled:  \n   `Llama-3.2-1B-Instruct-4bit_touch-rugby`  \n3. Click **Run**  \n4. Navigate to the **Interact** tab to start chatting\n\nYou can now test the model on questions about Touch Rugby rules, scoring systems, player positions, game procedures, and common scenarios.\n\n## Important Notes\n- This recipe uses **MLX optimization** for Apple Silicon (M1/M2/M3) chips\n- Uses **4-bit quantization** for efficient training and inference\n- LoRA fine-tuning preserves general capabilities while adding specialized knowledge\n- The workflow includes automated evaluation and example generation\n\n## Expected Outcomes\nAfter completing this recipe, your model should be able to:\n- Answer detailed questions about Touch Rugby rules and regulations\n- Explain game procedures, scoring, and player responsibilities\n- Handle both basic and complex Touch Rugby scenarios\n- Maintain general language understanding while specializing in rugby knowledge",
  "requiredMachineArchitecture": [
    "mlx"
  ],
  "dependencies": [
    {
      "type": "model",
      "name": "mlx-community/Llama-3.2-1B-Instruct-4bit"
    },
    {
      "type": "plugin",
      "name": "mlx_lora_trainer"
    },
    {
      "type": "dataset",
      "name": "Trelis/touch-rugby-rules"
    },
    {
      "type": "plugin",
      "name": "common-eleuther-ai-lm-eval-harness-mlx"
    },
    {
      "type": "plugin",
      "name": "synthesizer_scratch"
    }
  ],
  "tasks": [
    {
      "name": "fine_tune_touch_rugby",
      "task_type": "TRAIN",
      "type": "LoRA",
      "plugin": "mlx_lora_trainer",
      "formatting_template": "{{prompt}}\n{{completion}}",
      "config_json": "{\"template_name\":\"TouchRugby\",\"plugin_name\":\"mlx_lora_trainer\",\"model_name\":\"mlx-community/Llama-3.2-1B-Instruct-4bit\",\"model_architecture\":\"LlamaForCausalLM\",\"formatting_template\":\"{{prompt}}\\n{{completion}}\",\"dataset_name\":\"Trelis/touch-rugby-rules\",\"lora_layers\":\"16\",\"batch_size\":\"8\",\"learning_rate\":\"0.0001\",\"lora_rank\":\"32\",\"lora_alpha\":\"128\",\"iters\":\"120\",\"steps_per_report\":\"10\",\"steps_per_eval\":\"20\",\"save_every\":\"10\",\"adaptor\":\"touch-rugby\"}"
    },
    {
      "name": "evaluate_touch_rugby",
      "task_type": "EVAL",
      "plugin": "common-eleuther-ai-lm-eval-harness-mlx",
      "config_json": "{\"template_name\":\"HandsomeBadger\",\"plugin_name\":\"common-eleuther-ai-lm-eval-harness-mlx\",\"model_name\":\"mlx-community/Llama-3.2-1B-Instruct-4bit\",\"model_architecture\":\"MLX\",\"tasks\":\"mmlu\",\"limit\":\"0.5\",\"run_name\":\"HandsomeBadger\",\"predefined_tasks\":\"\",\"script_parameters\":{\"template_name\":\"HandsomeBadger\",\"plugin_name\":\"common-eleuther-ai-lm-eval-harness-mlx\",\"model_name\":\"mlx-community/Llama-3.2-1B-Instruct-4bit\",\"model_architecture\":\"MLX\",\"tasks\":\"mmlu\",\"limit\":\"0.5\",\"run_name\":\"HandsomeBadger\",\"predefined_tasks\":\"\"}}"
    },
    {
      "name": "generate_touch_rugby_examples",
      "task_type": "GENERATE",
      "plugin": "synthesizer_scratch",
      "config_json": "{\"template_name\":\"SparklingNarwhal\",\"plugin_name\":\"synthesizer_scratch\",\"model_name\":\"mlx-community/Llama-3.2-1B-Instruct-4bit\",\"model_architecture\":\"MLX\",\"generation_model\":\"local\",\"num_goldens\":\"51\",\"generate_expected_output\":\"Yes\",\"scenario\":\"You are an expert in Touch Rugby rules and regulations. Generate diverse training examples that cover various aspects of the game.\",\"task\":\"Create question-answer pairs about Touch Rugby rules, focusing on game procedures, scoring rules, player positions, and common scenarios.\",\"input_format\":\"A specific question about Touch Rugby rules, formatted as: Question: [question text].\",\"expected_output_format\":\"A clear, accurate answer explaining the relevant Touch Rugby rule, formatted as: Answer: [detailed explanation]\",\"run_name\":\"SparklingNarwhal\",\"generation_type\":\"scratch\",\"script_parameters\":{\"template_name\":\"SparklingNarwhal\",\"plugin_name\":\"synthesizer_scratch\",\"model_name\":\"mlx-community/Llama-3.2-1B-Instruct-4bit\",\"model_architecture\":\"MLX\",\"generation_model\":\"local\",\"num_goldens\":\"51\",\"generate_expected_output\":\"Yes\",\"scenario\":\"You are an expert in Touch Rugby rules and regulations. Generate diverse training examples that cover various aspects of the game.\",\"task\":\"Create question-answer pairs about Touch Rugby rules, focusing on game procedures, scoring rules, player positions, and common scenarios.\",\"input_format\":\"A specific question about Touch Rugby rules, formatted as: Question: [question text].\",\"expected_output_format\":\"A clear, accurate answer explaining the relevant Touch Rugby rule, formatted as: Answer: [detailed explanation]\",\"run_name\":\"SparklingNarwhal\",\"generation_type\":\"scratch\"}}"
    }
  ],
  "workflows": [
    {
      "name": "Workflow_1",
      "config": {
        "nodes": [
          {
            "id": "node_train",
            "type": "TRAIN",
            "task": "fine_tune_touch_rugby",
            "name": "Training Task",
            "out": [
              "node_eval"
            ]
          },
          {
            "id": "node_eval",
            "type": "EVAL",
            "task": "evaluate_touch_rugby",
            "name": "Evaluation Task",
            "out": [
              "node_generate"
            ]
          },
          {
            "id": "node_generate",
            "type": "GENERATE",
            "task": "generate_touch_rugby_examples",
            "name": "Generation Task",
            "out": []
          }
        ]
      }
    }
  ],
  "cardImage": "https://images.unsplash.com/photo-1558151507-c1aa3d917dbb?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
}